# My personal routine to install Arch Linux

$ loadkeys fr #Change Keyboard Layout

$ ping archlinux.org #Check if I have access to the internet

$ timedatectl set-ntp true #Set NTP
$ timedatectl status #Check the NTP Status

$ fdisk -l #Check the hard drives names to select the one I want to install Arch Linux on
$ fdisk /dev/nvme0n1 #Partitioning the disk I want to install Arch on

Partitions :
Delete current partitions ---> o option (This deletes every partitions, use the "d" option instead if you want to delete specific partitions)
Create a GPT partition table (cause I use EFI) ---> g option

Create a 550M EFI partition ---> n option
Create a Swap partition ---> n option (4G for me, https://itsfoss.com/swap-size/)
Create a Root partition with the rest ---> n option

Change the first partition type to EFI ---> t option, type 1
Change the second partition type to Linux swap ---> t option, type 19
Change the third partition type to Linux filesystem ---> t option, type 20

Write the table to the disk ---> w option

$ mkfs.fat -F32 /dev/nvme0n1p1 #Make the filesystem for the EFI partition
$ mkswap /dev/nvme0n1p2 #Make the filesystem for the Swap partition
$ swapon /dev/nvme0n1p2 #Activate swap on the system
$ mkfs.ext4 /dev/nvme0n1p3 # Make the filesystem for the Root partition

$ mount /dev/nvme0n1p3 /mnt #Mount the Root partition to install my system's base on it
$ mkdir -p /mnt/boot/EFI #Create the /boot/EFI directory
$ mount /dev/nvme0n1p1 /mnt/boot/EFI #Mount my EFI partition on it

$ pacstrap /mnt base linux linux-firmware #Install my system's base on the root partition

$ genfstab -U /mnt >> /mnt/etc/fstab #Generating the fstab

$ arch-chroot /mnt #Log in my new system's base on the root partition

$ ln -sf /usr/share/zoneinfo/Europe/Paris /etc/localtime #Set up my Region Info

$ hwclock --systohc #Update my Hardware Clock

$ pacman -S vim #Install vim (or any other editor), needed for the rest

$ vim /etc/pacman.conf #Enable parallel downloads
[...]
ParallelDownloads = 10
[...]

$ vim /etc/locale.gen #Uncomment my local in that file (for me : fr_FR.UTF-8 UTF-8)
$ locale-gen #Apply the configuration
$ vim /etc/locale.conf #Set the LANG variable accordingly in this file (for me : LANG=fr_FR.UTF-8
$ vim /etc/vconsole.conf #Set my Keymap in this file (for me : KEYMAP=fr)

$ vim /etc/hostname #Create the hostname file and put my hostname in it (for me : Arch Linux)
$ vim /etc/hosts #Edit the hosts file and add lines from the Arch Wiki ---> https://wiki.archlinux.org/index.php/Installation_guide#Network_configuration. For me:
127.0.0.1	localhost
::1		localhost
127.0.1.1	Arch-Linux.localdomain	Arch-Linux

$ passwd #Change the root password

$ useradd -m rcandau #Create my user
$ passwd rcandau #Setup a password for my user
$ usermod -aG wheel,audio,video,optical,storage,games rcandau #Add my user to some useful groups

$ pacman -S sudo #Install sudo
$ visudo #Uncomment the line that allows wheel group members to use sudo on any command ---> %wheel ALL=(ALL) ALL

$ pacman -S grub efibootmgr dosfstools mtools #Install the grub bootloader and dependencies for EFI. Also install "os-prober" if you wish to do a dual boot with another distro/OS.
$ grub-install --target=x86_64-efi --bootloader-id=arch-linux --recheck #Install grub on my EFI partition
$ grub-mkconfig -o /boot/grub/grub.cfg #Generating the Grub configuration file

$ pacman -S networkmanager #Install networkmanager (needed to get and manage my internet connexion)
$ systemctl enable NetworkManager #Autostart NetworkManager at boot

--Firewall Section--
Installing a firewall may be optionnal for a fresh and simple desktop install as Arch doesn't expose any service by default.
But it is a supplementary security layer you might consider (even tho there's a little chance you ever need it).
Check this link for more info/reasons to install a firewall : https://unix.stackexchange.com/questions/30583/why-do-we-need-a-firewall-if-no-programs-are-running-on-your-ports
$ pacman -S firewalld #Install a firewall
$ systemctl enable firewalld #Autostart the firewall at boot
$ firewall-cmd --remove-service="ssh" --permanent #Remove the opened ssh port by default as my PC doesn't run a ssh server
$ firewall-cmd --remove-service="dhcpv6-client" --permanent #Remove the opened DHCPV6-client port by default as I don't use it
$ firewall-cmd --reload #Apply changes
--End of the Firewall Section--

$ exit #Get out of the chroot
$ umount -l /mnt #Umount my /mnt mounted point

$ reboot #Reboot the computer to boot into my fresh Arch Install

# Log in with my user (rcandau)

$ sudo pacman -S base-devel linux-headers man bash-completion xorg-server intel-ucode nvidia #Installing additional useful packages and drivers for my system

--Desktop Environment Section--
I've used GNOME and XFCE in the past (performing minimal installations) but I recently switched to IceWM. Here's my installation routine for the three of them. 

##Minimal GNOME installation (according to my personal preferences. Check https://archlinux.org/groups/x86_64/gnome/ & https://archlinux.org/groups/x86_64/gnome-extra/ to see what you want to install or not). If you want a complete GNOME installation, just install the "gnome" package (and the "gnome-extra" package if you want to)##
$ sudo pacman -S $(curl https://raw.githubusercontent.com/Antiz96/Linux-Customisation/main/Arch-Linux/Packages/gnome-minimal-packages.txt)
$ sudo systemctl enable gdm

##Minimal XFCE installation (according to my personal preferences. Check https://archlinux.org/groups/x86_64/xfce4/ & https://archlinux.org/groups/x86_64/xfce4-goodies/ to see what you want to install or not). If you want a complete XFCE installation, just install the "xfce4" and the "xfce4-goodies" packages##
$ sudo pacman -S $(curl https://raw.githubusercontent.com/Antiz96/Linux-Customisation/main/Arch-Linux/Packages/xfce-minimal-packages.txt)
$ sudo systemctl enable lightdm

##Minimal IceWM installation (according to my personal preferences).
$ sudo pacman -S $(curl https://raw.githubusercontent.com/Antiz96/Linux-Customisation/main/Arch-Linux/Packages/icewm-minimal-packages.txt)

$ cp /etc/X11/xinit/xinitrc ~/.xinitrc

$ vim ~/.xinitrc (Delete the 5 last lines and add the following ones)
#Start IceWM
export XDG_SESSION_TYPE=X11
numlockx &
exec icewm-session

$ vim ~/.bash_profile
[...]
#Autostart IceWM
if [ -z "${DISPLAY}" ] && [ "${XDG_VTNR}" -eq 1 ]; then
  exec startx
fi
--End of the Desktop Environment Section--

$ localectl --no-convert set-x11-keymap fr #Configure Keyboard layout for x11

$ sudo grub-mkconfig -o /boot/grub/grub.cfg #Regenerating grub configuration (Specially for intel-ucode)

$ reboot #Reboot into my system with GUI (select GNOME on XORG in GDM if I installed GNOME)

# Base Installation complete
