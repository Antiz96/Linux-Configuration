##Install Debian 11 (bullseye) minimal (No DE, no standard or aditionnal packages, nothing)

#Partitioning :
--System Disk--
550 MB --> EFI Sytem
4G --> Swap
Left --> ext4 / (0% reserved block)

--Storage Disk--
All space --> ext4 /storage (0% reserved block)


##Log as root

#Static IP Address (create the DNS record on Pihole)
$ vi /etc/network/interfaces
[...]
iface enp0s3 inet static
        address 192.168.1.100/24
        gateway 192.168.1.254
        dns-nameservers 192.168.1.1

#Install sudo and put user in the sudo group
$ apt install sudo
$ usermod -aG sudo rcandau

#Create a VMs directory with regular user permission in /storage
$ mkdir -p /storage/VMs

#Create a ISO directory with regular user permission in /storage
$ mkdir -p /storage/ISO

#Reboot to apply all changes
$ reboot


##Log as regular user

#Update the machine and install usefull packages (which I'll use to administrate the machine and perform various tasks. The selection is subjective tho)
$ sudo apt update && sudo apt full-upgrade
$ sudo apt install vim man bash-completion openssh-server mlocate htop curl chrony ksmtuned ssh-askpass

#Configure ssh-askpass
$ sudo vim /etc/sudo.conf
[...]
# Sudo askpass:
Path askpass /usr/bin/ssh-askpass
[...]

#Download and edit my .bashrc
$ curl https://raw.githubusercontent.com/Antiz96/Linux-Customisation/master/Dotfiles/General/bashrc%20\(Debian-Ubuntu%20Based%20Distro%20SERVER%20-%20WSL\) -o ~/.bashrc
$ vim ~/.bashrc (delete all tmux part and flatpak in the fullupgrade alias)
$ source ~/.bashrc


##Install Proxmox
https://pve.proxmox.com/wiki/Install_Proxmox_VE_on_Debian_11_Bullseye
User Management Part : Create regular user in Datacenter --> Permissions --> User (Linux Pam authentication)
Linux Bridge Part : In Promox --> System --> Network, edit the actual network card and delete IP/Netmask and Gateway. Once done, create a new "Linux Bridge" card, add the IP/Netmask and Gateway and add the actual network card as the bridge port.


##Add storage for VMs and ISO
Datacenter --> Storage
ADD - Type : directory | ID : VMs | Directory : /storage/VMs | Cotent : Disk Image
ADD - Type : directory | ID : ISO | Directory : /storage/ISO | Cotent : ISO Image
EDIT local directory --> uncheck "activate" checkbox


##Additionnal configuration

#Modify proxmox repo from "enterprise" to "no-subscription" (as I do not use a subscription for my personal needs, I do not have a subscription key. Therefore, I cannot authenticate to the enterprise repo and use it, leading to an error "401 unauthorized" when performing "apt update").
https://drive.google.com/file/d/19hSC_O42fNMEZZUC-u2vSnqk02fEzGg_/view
$ sudo mv /etc/apt/sources.list.d/pve-enterprise.list /etc/apt/sources.list.d/pve-enterprise.list-bck
$ sudo cp -p /etc/apt/sources.list.d/pve-enterprise.list-bck /etc/apt/sources.list.d/pve-no-subscription.list
$ sudo vim /etc/apt/sources.list.d/pve-no-subscription.list
deb http://download.proxmox.com/debian bullseye pve-no-subscription

#Get rid of the "No valid subscription key found" message when loggin in (for the same reason as above)
https://johnscs.com/remove-proxmox51-subscription-notice/
$ sudo cp -p /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js-bck
$ sudo vim /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js --> Change "Ext.Msg.show" from "void"
[...]
void({
  title: gettext('No valid subscription'),
[...]
$ sudo systemctl restart pveproxy


##Useful informations/tips and general usage

#Datacenter
Sum up --> gives you a sum up of your datacenter state
Storage --> Manage, delete and create different storage type for different usage (ISO, VMs Disk, Backup, Container, Templates, etc...)

#
To upload an ISO to the ISOs storage, click on it 
$ rsync -vzPhe "ssh -X" --rsync-path="sudo -A rsync" /run/media/rcandau/data/ISO/* rcandau@192.168.1.100:/storage/ISO/template/iso

